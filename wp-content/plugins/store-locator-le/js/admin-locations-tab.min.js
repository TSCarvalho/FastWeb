var SLP_Location_Manager=SLP_Location_Manager||{};var SLP_Location_Form_Handler=function(){this.populate_field=function(d,c,a){var b="[data-field='"+d+"']";this.set_value(a.find(b),this.get_value(c.find(b)));return d};this.get_value=function(a){if(a.attr("data-value")){return a.attr("data-value")}if(a.attr("value")){return a.val()}return a.html()};this.set_value=function(a,b){if(a.is(":checkbox")){a.prop("checked",b>0);return}if(a.is("input")){a.val(b);return}a.html(b)};this.hide=function(a){a.removeClass("unhidden");a.addClass("hidden");a.hide()};this.show=function(a){a.removeClass("hidden");a.addClass("unhidden");a.show()}};var SLP_Locations_map=function(){var b;var a;this.show_map=function(d){if(typeof d==="undefined"){return}var h=d.find("#location_map");if(typeof h==="undefined"){return}var i=SLP_Location_Manager.Form_Handler.get_value(d.find('[data-field="sl_latitude"]'));var g=SLP_Location_Manager.Form_Handler.get_value(d.find('[data-field="sl_longitude"]'));if(!i){return}if(!g){return}var c=new google.maps.LatLng(i,g);var f={center:c,disableDefaultUI:true,draggable:true,disableDoubleClickZoom:true,keyboardShortcuts:false,zoom:14};this.map=new google.maps.Map(h[0],f);var e={position:c,map:this.map,title:d.find('[data-field="sl_store"]').html(),icon:this.set_icon(d)};this.marker=new google.maps.Marker(e);slp_AdminFilter("location_map_initialized").publish()};this.set_icon=function(c){var d=c.find('[data-field="marker"] img').attr("src");if(!d){d=c.find('[data-field="category_marker"]').attr("src");if(!d){d=location_manager.default_marker}}return d};this.add_marker_at_center=function(){this.centerMarker=new slp_Marker(this,"",this.homePoint,this.mapHomeIconUrl)}};var SLP_Locations_table=function(){this.initialize=function(){jQuery("a.delete_location").click(this.delete_location)};this.delete_location=function(a){var c=new Object();c.action="slp_delete_location";c.location_id=jQuery(this).attr("data-id");var b=jQuery("#location-"+c.location_id);b.css("background-color","#FFF4DD");b.fadeOut(400,function(){b.remove()});jQuery.post(ajaxurl,c,this.process_delete_location_response,"json")};this.process_delete_location_response=function(b){var a=JSON.parse(b);if(a.status!=="ok"){alert("Location not deleted.")}};this.show_location_details=function(a){var b=new Object();b.action="slp_get_location";b.location_id=jQuery(this).attr("data-id");alert(b.location_id)}};var SLP_Locations_table_header=function(){this.initialize=function(){jQuery("#do_action_apply_to_all").click(this.execute_apply_to_all);jQuery("#do_action_apply").click(this.execute_apply)};this.execute_apply=function(){SLP_Location_Manager.table_header.execute_apply_bulk_action(false)};this.execute_apply_to_all=function(){SLP_Location_Manager.table_header.execute_apply_bulk_action(true)};this.execute_apply_bulk_action=function(c){var a=jQuery("#actionType").val();if(a==="-1"){return false}var b=jQuery("#actionType option:selected").text();if(confirm("Are you sure you want to "+b+"?")){if(c){jQuery("<input />").attr("type","hidden").attr("name","apply_to_all").attr("value","1").appendTo("#locationForm")}AdminUI.doAction(a)}return false}};var SLP_Location_Card=function(){this.initialize=function(){jQuery("span.store_name").click(function(){SLP_Location_Manager.Card.show_location_details(jQuery(this).parents("tr").first())});jQuery(".location-card").click(function(){SLP_Location_Manager.Form_Handler.hide(jQuery(".location-card"))})};this.show_location_details=function(j){var h=j.children(".slp_manage_locations_cell");var o=jQuery(".location-card");var e=["sl_store_complex"];var n="";var q=jQuery(".location-card .primary .card-header");e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_store",j,q));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_address",j,q));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_city",j,q));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_state",j,q));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_zip",j,q));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_country",j,q));var l=jQuery(".location-card .primary .card-footer");e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_id",j,l));var m=jQuery(".location-card .secondary");e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_latitude",j,m));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_longitude",j,m));e.push(SLP_Location_Manager.Form_Handler.populate_field("sl_url",j,m));var b;var i;var k=jQuery(".location-card .card-body .card-info-grid");k.html("");for(var p=0,r=h.length;p<r;p++){if(!h[p]){continue}if(h[p].innerHTML==""){continue}b=jQuery(h[p]).attr("data-field");i=jQuery(h[p]).attr("data-colname");if(jQuery.inArray(b,e)!==-1){continue}k.append('<div class="col"><strong class="label">'+i+'</strong><span contenteditable="true" data-field="'+b+'">'+h[p].innerHTML+"</span></div>")}var a=jQuery("#manage_locations_table").offset();var f=jQuery("#manage_locations_table").outerWidth();var g=j.offset();var s=j.outerHeight();var t=jQuery(".location-card").outerHeight();var d=g.top+s;var c=jQuery(window).width()-(a.left+f);if(d+t>jQuery(window).height()){d=g.top-t}o.css({top:d,right:c});SLP_Location_Manager.Form_Handler.show(o);SLP_Location_Manager.locations_map.show_map(o)};this.clear_more_info=function(){jQuery(".settings-description").toggleClass("is-visible").html("")}};var SLP_Location_Editor=function(){var a=jQuery("#wpcsl-option-add");this.initialize=function(){jQuery(".add_location_modal input.cancel_button").click(function(){SLP_Location_Manager.Form_Handler.hide(a);jQuery("#wpcsl-option-current_locations_sidemenu").click()});jQuery('[name="edit-location"]').click(function(){SLP_Location_Manager.Editor.load_and_show_form(jQuery(this))});jQuery("#wpcsl-option-add_sidemenu").click(function(){SLP_Location_Manager.Editor.load_and_show_form(jQuery(this))})};this.load_and_show_form=function(b){SLP_Location_Manager.Form_Handler.hide(jQuery(".location-card"));this.load_form(a,b);SLP_Location_Manager.Form_Handler.show(a);SLP_Location_Manager.locations_map.show_map(a)};this.load_form=function(f,e){var d;var g=jQuery("#locationForm");var i=e.attr("data-id");var b;var h;if(i){b=jQuery('#manage_locations_table tr[data-id="'+i+'"]');g.find("#act").val("save");g.find("#id").val(i);g.find("#locationID").val(i);g.find("#wpcsl_settings_group-map").show();h=location_manager.edit_text}else{b=e;g.find("#act").val("add");g.find("#id").val(i);g.find("#locationID").val(i);g.find("#wpcsl_settings_group-map").hide();h=location_manager.add_text}g.find("#modalTitle").html(h);f.find("input :submit").each(function(j){jQuery(this).attr("alt",h);jQuery(this).attr("title",h);jQuery(this).attr("onclick","")});f.find("[data-field]").each(function(j){SLP_Location_Manager.Form_Handler.populate_field(jQuery(this).attr("data-field"),b,f)});var c=new Object();c.table_row=b;c.form_div=f;c.mode=g.find("#act").val();slp_Admin_Filter("location_edit_init").publish(c)}};jQuery(document).ready(function(){SLP_Location_Manager.Form_Handler=new SLP_Location_Form_Handler();SLP_Location_Manager.locations_map=new SLP_Locations_map();SLP_Location_Manager.table=new SLP_Locations_table();SLP_Location_Manager.table.initialize();SLP_Location_Manager.table_header=new SLP_Locations_table_header();SLP_Location_Manager.table_header.initialize();var a=new Object();a.stripeClasses=[];a.info=false;a.paging=false;a.searching=false;a.responsive=true;a.colReorder=true;a.columnDefs=[{targets:[0,1],visible:true,orderable:false},{targets:"_all",visible:true,searchable:false,orderable:true}];if(location_manager.all_displayed){a.ordering=true}else{a.ordering=false}SLP_Location_Manager.table=jQuery("#manage_locations_table").DataTable(a);if(jQuery("#wpcsl-option-current_locations div.section_description").is(":empty")){jQuery("#wpcsl-option-add_location_sidemenu").click()}SLP_Location_Manager.Editor=new SLP_Location_Editor();SLP_Location_Manager.Editor.initialize();SLP_Location_Manager.Card=new SLP_Location_Card();SLP_Location_Manager.Card.initialize()});